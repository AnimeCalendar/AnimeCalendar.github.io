"use strict";Date.prototype.getWeek=function(){const e=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()));return e.setDate(e.getDate()-e.getDay()),Math.ceil((e.valueOf()-new Date(e.getFullYear(),0,1).valueOf())/864e5/7)};class Calendar{constructor(e){this.getDates=(e=0)=>{const t=[],s=new Date;let i=s.getDate();const n=s.getMonth(),l=s.getFullYear();switch(s.getDay()){case 0:i+=e-6;break;case 1:i+=e;break;case 2:i+=e-1;break;case 3:i+=e-2;break;case 4:i+=e-3;break;case 5:i+=e-4;break;default:i+=e-5}for(let e=0;e<7;e++)t.push(new Date(l,n,i+e));return t},this.ider_slot=(e,t)=>":"===t.substring(1,2)?1e4*e+100*Number(t.substring(0,1))+Number(t.substring(2,4))+t.substring(5,6):1e4*e+100*Number(t.substring(0,2))+Number(t.substring(3,5))+t.substring(6,7),this.ider_show=e=>{const t=e.split(" ");return e.length+t.length.toString()+t[t.length-1].replace(/\W/g,"")},this.minMax=(e,t)=>new Date(`2000/1/1 ${e}`)<new Date(`2000/1/1 ${t}`)?[e,t]:[t,e],this.resizeCalendar=()=>{const e=document.getElementById("calendar");e&&(e.style.height="0"===document.getElementById("info").value&&document.getElementById("show")?"38vh":"85vh")},this.shows=JSON.parse(localStorage.getItem("shows"))??{},this.left=document.getElementById("left"),this.right=document.getElementById("right"),this.left.style.visibility="visible",this.right.style.visibility="visible",this.past=JSON.parse(localStorage.getItem("past")),this.store=JSON.parse(localStorage.getItem("store")),localStorage.getItem("ver")!==e&&(localStorage.setItem("ver",e),this.set("./shows/shows.json","store"),this.set("./shows/past_shows.json","past").then((()=>{Object.keys(this.shows).forEach((e=>{e in this.store||e in this.past||delete this.shows[e]})),localStorage.setItem("shows",JSON.stringify(this.shows))})))}async set(e,t){const s=await(await fetch(e)).json();"store"===t?this.store=s:this.past=s,localStorage.setItem(t,JSON.stringify(s))}async init(e=0){const t=document.getElementById("calendar");t?t.remove():document.getElementById("season").remove(),this.updateTime();const s=localStorage.getItem("format");let i,n=await(await fetch(0===e?"./shows/time.json":"./shows/past_time.json")).json();switch(s){case"1":n=n.cutoff;break;case"2":n=n.compact;break;default:n=n.full}if("Your List"===localStorage.getItem("list")||0===Object.keys(this.shows).length)i=n;else switch(s){case"1":i=this.cutoff(n,e);break;case"2":i=this.compact(n,e);break;default:i=this.full(n,e)}this.calendar(this.getDates(e),i),this.resizeCalendar(),this.createShows(e)}calendar(e,t){document.getElementById("month").innerHTML=e[0].getMonth()===e[6].getMonth()?e[0].toLocaleDateString("en-US",{month:"long"}):`${e[0].toLocaleDateString("en-US",{month:"long"})} to ${e[6].toLocaleDateString("en-US",{month:"long"})}`;let s=document.createElement("td");s.className="date corner";let i=document.createElement("tr");i.append(s),e.forEach((async e=>{s=document.createElement("td"),s.className="date",s.innerHTML=`${e.getDate()} ${e.toLocaleDateString("en-US",{weekday:"long"})}`,s.title=`${e.getDate()} ${e.toLocaleDateString("en-US",{weekday:"short"})}`,i.append(s)}));const n=document.createElement("thead");n.append(i);const l=document.createElement("tbody");t.forEach((async e=>{s=document.createElement("td"),s.className="time",s.innerHTML=e,i=document.createElement("tr"),i.append(s);for(let t=1;t<8;t++)s=document.createElement("td"),s.id=this.ider_slot(t,e),s.className="slot",i.append(s);l.append(i)}));const a=document.createElement("table");a.append(n),a.append(l);const o=document.createElement("div");o.id="calendar",o.tabIndex=1,o.append(a),document.body.append(o)}createShows(e){const t=0===e?this.store:this.past;Object.keys("Your List"===document.getElementById("list").innerHTML?t:this.shows).forEach((e=>{if(e in t){const s=document.createElement("button");s.id=this.ider_show(e),s.className="show",s.innerHTML=t[e].title,s.setAttribute("key",e),e in this.shows&&(s.style.borderColor="#4f004f",s.style.color=("visible"===this.left.style.visibility?this.shows[e][0]:this.shows[e][1])?"#4f4f4f":"purple"),s.onclick=e=>{"0"===localStorage.getItem("info")?document.getElementById("title")&&e.preventDefault():e.preventDefault(),this.streamInfo(e.target.attributes.getNamedItem("key").value)};const i=document.createElement("a"),n=this.ider_slot(t[e].day,t[e].time);i.href=`#${n}`,i.append(s),document.getElementById(n).append(i)}}))}full(e,t){const s={...this.shows},i=0===t?this.store:this.past,n=[];for(let t=0;t<e.length;t++)e[t].includes("00")||e[t].includes("30")?n.push(e[t]):Object.keys(s).some((l=>{if(l in i){if(i[l].time.includes("00")||i[l].time.includes("30"))delete s[l];else if(e[t]===i[l].time)return n.push(e[t]),delete s[l],1}else delete s[l];return 0}));return n}cutoff(e,t){const s={...this.shows},i=0===t?this.store:this.past;let n="12:00 AM",l="11:59 PM";switch(Object.keys(s).length){case 0:return e;case 1:return[i[Object.keys(s)[0]].time];default:Object.keys(s).forEach((e=>{e in i?([,n]=this.minMax(n,i[e].time),[l]=this.minMax(l,i[e].time),(i[e].time.includes("00")||i[e].time.includes("30"))&&delete s[e]):delete s[e]}))}const a=[];let o=!1;for(let t=0;t<=e.length;t++)if(l===e[t])a.push(e[t]),o=!0;else{if(n===e[t]){a.push(e[t]);break}if(o)if(e[t].includes("00")||e[t].includes("30"))a.push(e[t]);else{const n=Object.keys(s).find((s=>e[t]===i[s].time));n&&(a.push(e[t]),delete s[n])}}return a}compact(e,t){const s=0===t?this.store:this.past,i={...this.shows},n=[];for(let t=0;t<e.length&&(Object.keys(i).some((l=>l in s&&s[l].time===e[t]?(n.push(e[t]),delete i[l],1):(l in s||delete i[l],0))),0!==Object.keys(i).length);t++);return n}streamInfo(e){const t=e in this.store?this.store:this.past,s=document.getElementById("show");s&&s.remove();let i=document.createElement("td");i.id="title",i.innerHTML=t[e].title,i.setAttribute("key",e);let n=document.createElement("tr");n.append(i);const l=document.createElement("tbody");l.append(n);const a=document.createElement("table");if(0===Object.keys(t[e].streams).length){i=document.createElement("td"),i.innerHTML="No legal stream available",n=document.createElement("tr"),n.append(i),l.append(n);const e=document.createElement("img");e.className="icon",e.src="assets/skull.svg";const t=document.createElement("a");t.id="0",t.className="stream",t.onclick=()=>this.Stream(),t.href="#",t.append(e),t.innerHTML+=" High Seas",i=document.createElement("td"),i.innerHTML="1 ",i.append(t),n=document.createElement("tr"),n.append(i),l.append(n)}else Object.entries(t[e].streams).forEach((([e,t],s)=>{const a=document.createElement("img");switch(a.className="icon",e){case"Amazon":a.src="assets/amazon.svg";break;case"AnimeLab":a.src="assets/animelab.svg";break;case"Crunchyroll":a.src="assets/crunchyroll.svg";break;case"Funimation":a.src="assets/funimation.svg";break;case"HiDive":a.src="assets/hidive.svg";break;case"Hulu":a.src="assets/hulu.svg";break;case"VRV":a.src="assets/vrv.svg";break;case"Wakanim":a.src="assets/wakanim.svg";break;case"YouTube":a.src="assets/youtube.svg";break;default:a.src="assets/netflix.svg"}const o=document.createElement("a");o.id=s.toString(),o.href=t,o.target="_blank",o.className="stream",o.onclick=()=>this.Stream(),o.append(a),o.innerHTML+=` ${e}`,i=document.createElement("td"),i.innerHTML=`${s+1} `,i.append(o),n=document.createElement("tr"),n.append(i),l.append(n)}));a.append(l);const o=document.createElement("button");o.className="setter",o.onclick=()=>this.setter(),e in this.shows?(o.id="sub",o.innerHTML="Remove from Your List"):(o.id="add",o.innerHTML="Add to Your List");const r=document.createElement("button");let c,d,m,h;r.onclick=()=>this.Reset(),r.id="reset",r.innerHTML="Reset",r.style.visibility=e in this.shows&&("visible"===this.left.style.visibility?this.shows[e][0]:this.shows[e][1])?"visible":"hidden";const u=localStorage.getItem("info");"1"===u?(c=document.createElement("aside"),c.append(a),c.append(o),c.append(r)):(h=document.createElement("img"),h.src=`https://cdn.animeschedule.net/production/assets/public/img/anime/jpg/default/${t[e].cover}.jpg`,m=document.createElement("div"),m.className="cover",m.append(h),d=document.createElement("div"),d.id="streams",d.append(a),c=document.createElement("div"),"2"===u&&(c.className="window"),c.append(o),c.append(r),c.append(m),c.append(d)),c.id="show",document.getElementById("content").append(c),this.resizeCalendar(),document.getElementById("clear").style.visibility="visible"}updateTime(){const e=JSON.parse(localStorage.getItem("time"));let t=new Date;t=[t.getWeek(),t.getFullYear()],null!=e&&(t[0]-e[0]==1&&t[1]===e[1]||t[1]-e[1]==1&&52===t[0]?Object.keys(this.shows).forEach((e=>{[this.shows[e][0],this.shows[e][1]]=[!1,this.shows[e][0]]})):t[0]===e[0]&&t[1]===e[1]||Object.keys(this.shows).forEach((e=>{[this.shows[e][0],this.shows[e][1]]=[!1,!1]})),localStorage.setItem("shows",JSON.stringify(this.shows))),localStorage.setItem("time",JSON.stringify(t))}link(e){const t=document.getElementById(e);t&&this.Stream(),t.href.includes(window.location.host)||window.open(t.href)}Stream(){const e=document.getElementById("title").attributes.getNamedItem("key").value;e in this.shows&&(this.updateSetter(e,!0),document.getElementById(this.ider_show(e)).style.color="#4f4f4f",document.getElementById("reset").style.visibility="visible"),localStorage.setItem("shows",JSON.stringify(this.shows))}updateSetter(e,t){"visible"===this.left.style.visibility?this.shows[e][0]=t:this.shows[e][1]=t}Reset(){const e=document.getElementById("title").attributes.getNamedItem("key").value;this.updateSetter(e,!1),document.getElementById(this.ider_show(e)).style.color="purple",document.getElementById("reset").style.visibility="hidden",localStorage.setItem("shows",JSON.stringify(this.shows))}arrow(){let e=document.getElementById("title");e&&(e=e.innerHTML,document.getElementById("season")?document.getElementById("show").remove():e in this.shows&&(document.getElementById("reset").style.visibility=("visible"===this.left.style.visibility?this.shows[e][0]:this.shows[e][1])?"visible":"hidden"))}setter(){const e=document.getElementById("title").attributes.getNamedItem("key").value,t=document.querySelector(".setter");if("add"===t.id){const s=document.getElementById(this.ider_show(e));s&&(s.style.borderColor="#4f004f"),t.innerHTML="Remove from Your List",t.id="sub",this.shows[e]=[!1,!1]}else e in this.shows&&(delete this.shows[e],document.getElementById("reset").style.visibility="hidden",document.getElementById(this.ider_show(e)).style.borderColor="#484848",t.innerHTML="Add to Your List",t.id="add");localStorage.setItem("shows",JSON.stringify(this.shows));"Full List"===document.getElementById("list").innerHTML&&("visible"===this.left.style.visibility?this.init():this.init(-7))}format(){localStorage.setItem("format",document.getElementById("format").value),"visible"===this.left.style.visibility?this.init():this.init(-7)}clear(){const e=document.getElementById("show");e&&(e.remove(),document.getElementById("clear").style.visibility="hidden",this.resizeCalendar())}Left(){"visible"===this.left.style.visibility&&("visible"===this.right.style.visibility?(this.left.style.visibility="hidden",this.init(-7)):(this.right.style.visibility="visible",this.left.style.visibility="visible",this.init()))}Right(){"visible"===this.right.style.visibility&&("visible"===this.left.style.visibility?(this.right.style.visibility="hidden",document.getElementById("clear").style.visibility="hidden",document.getElementById("calendar").remove(),document.getElementById("month").innerHTML="Summer 2024",SON.init()):(this.right.style.visibility="visible",this.left.style.visibility="visible",this.init()))}info(){localStorage.setItem("info",document.getElementById("info").value),document.getElementById("title")&&this.streamInfo(document.getElementById("title").attributes.getNamedItem("key").value)}}
