"use strict";let PAST=JSON.parse(localStorage.getItem("past")),STORE=JSON.parse(localStorage.getItem("store"));document.getElementById("info").selectedIndex=parseInt(localStorage.getItem("info")),document.getElementById("format").selectedIndex=parseInt(localStorage.getItem("format")),localStorage.getItem("list")&&(document.getElementById("list").innerHTML=localStorage.getItem("list")),localStorage.getItem("shows")||localStorage.setItem("shows",JSON.stringify({}));let LEFT=document.getElementById("left"),RIGHT=document.getElementById("right");function hotkey(e){return"search"!=e.target.id&&!e.ctrlKey&&!e.altKey}function format(){localStorage.setItem("format",document.getElementById("format").value),"visible"==LEFT.style.visibility?TheBigBang():TheBigBang(-7)}function clear(){let e=document.getElementById("show");e&&(e.remove(),document.getElementById("clear").style.visibility="hidden",document.getElementById("calendar").style.height="50rem")}function list(){let e=document.getElementById("list");e.innerHTML="Full List"==e.innerHTML?"Your List":"Full List",localStorage.setItem("list",e.innerHTML),document.getElementById("calendar")&&(document.getElementById("soon")||("visible"==LEFT.style.visibility?TheBigBang():TheBigBang(-7)))}function left(){if("visible"==LEFT.style.visibility)if("visible"==RIGHT.style.visibility)LEFT.style.visibility="hidden",TheBigBang(-7);else{let e=document.getElementById("soon");e&&e.remove(),RIGHT.style.visibility="visible",LEFT.style.visibility="visible",TheBigBang()}}function right(){"visible"==RIGHT.style.visibility&&("visible"==LEFT.style.visibility?(RIGHT.style.visibility="hidden",document.getElementById("calendar").remove(),document.getElementById("month").textContent="Fall 2021",season()):(RIGHT.style.visibility="visible",LEFT.style.visibility="visible",TheBigBang()))}function info(){localStorage.setItem("info",document.getElementById("info").value),document.getElementById("title")&&streamInfo(document.getElementById("title").innerHTML)}async function set(e,t){let n=await(await fetch(e)).json();"store"==t?STORE=n:PAST=n,localStorage.setItem(t,JSON.stringify(n))}function TheBigBang(e=0){let t=document.getElementById("calendar");t?t.remove():document.getElementById("season").remove(),updateTime();let n=localStorage.getItem("format");fetch(0==e?"./shows/time.json":"./shows/past_time.json").then((e=>e.json())).then((t=>{switch(n){case"1":t=t.cutoff;break;case"2":t=t.compact;break;default:t=t.full}let l;if("Your List"==localStorage.getItem("list")||0==Object.keys(JSON.parse(localStorage.getItem("shows"))).length)l=t;else switch(n){case"1":l=cutoff(t,e);break;case"2":l=compact(t,e);break;default:l=full(t,e)}document.body.append(calendar(getDates(e),l)),resizeCalendar(),createShows(e)}))}function calendar(e,t){document.getElementById("month").innerHTML=e[0].getMonth()==e[6].getMonth()?e[0].toLocaleDateString("en-US",{month:"long"}):e[0].toLocaleDateString("en-US",{month:"long"})+" to "+e[6].toLocaleDateString("en-US",{month:"long"});let n=document.createElement("td");n.className="date";let l=document.createElement("tr");l.append(n),e.forEach((async function(e){n=document.createElement("td"),n.className="date",n.innerHTML=e.getDate()+" "+e.toLocaleDateString("en-US",{weekday:"long"}),l.append(n)}));let s=document.createElement("thead");s.append(l);let a=document.createElement("tbody");t.forEach((async function(e){n=document.createElement("td"),n.className="time",n.innerHTML=e,l=document.createElement("tr"),l.append(n);for(let t=1;t<8;t++)n=document.createElement("td"),n.id=ider_slot(t,e),n.className="slot",l.append(n);a.append(l)}));let i=document.createElement("table");i.append(s),i.append(a);let o=document.createElement("div");return o.id="calendar",o.append(i),o}function getDates(e=0){let t=[],n=new Date,l=n.getDate(),s=n.getMonth(),a=n.getFullYear();switch(n.getDay()){case 0:l+=e-6;break;case 1:l+=e;break;case 2:l+=e-1;break;case 3:l+=e-2;break;case 4:l+=e-3;break;case 5:l+=e-4;break;case 6:l+=e-5}for(let e=0;e<7;e++)t.push(new Date(a,s,l+e));return t}function ider_slot(e,t){return":"==t.substring(1,2)?1e4*e+100*parseInt(t.substring(0,1))+parseInt(t.substring(2,4))+t.substring(5,6):1e4*e+100*parseInt(t.substring(0,2))+parseInt(t.substring(3,5))+t.substring(6,7)}function ider_show(e){let t=e.split(" ");return e.length+t.length.toString()+t[t.length-1].replace(/\W/g,"")}function createShows(e){const t=0==e?STORE:PAST,n=JSON.parse(localStorage.getItem("shows"));for(let e in"Your List"==document.getElementById("list").innerHTML?t:n)if(e in t){let l=document.createElement("button");l.id=ider_show(e),l.className="show",l.innerHTML=e,e in n&&(l.style.borderColor="#4f004f",l.style.color=("visible"==LEFT.style.visibility?n[e][0]:n[e][1])?"#4f4f4f":"purple"),l.onclick=function(e){"0"==localStorage.getItem("info")?document.getElementById("title")&&e.preventDefault():e.preventDefault(),streamInfo(this.innerHTML)};let s=document.createElement("a"),a=ider_slot(t[e].day,t[e].time);s.href="#"+a,s.append(l),document.getElementById(a).append(s)}}function full(e,t){const n=JSON.parse(localStorage.getItem("shows")),l=0==t?STORE:PAST;let s=[];for(let t in e)if(e[t].includes("00")||e[t].includes("30"))s.push(e[t]);else for(let a in n)if(a in l){if(l[a].time.includes("00")||l[a].time.includes("30"))delete n[a];else if(e[t]==l[a].time){s.push(e[t]),delete n[a];break}}else delete n[a];return s}function minMax(e,t){return new Date("2000/1/1 "+e)<new Date("2000/1/1 "+t)?[e,t]:[t,e]}function cutoff(e,t){const n=JSON.parse(localStorage.getItem("shows")),l=0==t?STORE:PAST;let s="12:00 AM",a="11:59 PM";switch(n.length){case 0:return e;case 1:return[l[Object.keys(n)[0]].time];default:for(let e in n)e in l?(s=minMax(s,l[e].time)[1],a=minMax(a,l[e].time)[0],(l[e].time.includes("00")||l[e].time.includes("30"))&&delete n[e]):delete n[e]}let i=[],o=!1;for(let t in e)if(a==e[t])i.push(e[t]),o=!0;else{if(s==e[t]){i.push(e[t]);break}if(o)if(e[t].includes("00")||e[t].includes("30"))i.push(e[t]);else for(let s in n)if(e[t]==l[s].time){i.push(e[t]),delete n[s];break}}return i}function compact(e,t){const n=0==t?STORE:PAST,l=JSON.parse(localStorage.getItem("shows"));let s=[];for(let t in e){for(let a in l){if(a in n&&n[a].time==e[t]){s.push(e[t]),delete l[a];break}a in n||delete l[a]}if(0==l.length)break}return s}function resizeCalendar(){document.getElementById("calendar").style.height=document.getElementById("show")&&"0"==document.getElementById("info").value?"25rem":"50rem"}function streamInfo(e){const t=e in STORE?STORE:PAST;let n=document.getElementById("show");n&&n.remove();let l=document.createElement("td");l.id="title",l.innerHTML=e;let s=document.createElement("tr");s.append(l);let a=document.createElement("tbody");a.append(s);let i=document.createElement("table");if(i.className="table",0==Object.keys(t[e].streams).length){l=document.createElement("td"),l.innerHTML="No legal stream available",s=document.createElement("tr"),s.append(l),a.append(s);let e=document.createElement("img");e.className="icon",e.src="assets/skull.svg";let t=document.createElement("a");t.id="0",t.className="stream",t.href="#",t.append(e),t.innerHTML+=" High Seas",l=document.createElement("td"),l.innerHTML="1 ",l.append(t),s=document.createElement("tr"),s.append(l),a.append(s)}else for(const[n,[i,o]]of Object.entries(Object.entries(t[e].streams))){let e=document.createElement("img");switch(e.className="icon",i){case"Crunchyroll":e.src="assets/crunchyroll.svg";break;case"Funimation":e.src="assets/funimation.svg";break;case"VRV":e.src="assets/vrv.svg";break;case"AnimeLab":e.src="assets/animelab.svg";break;case"Hulu":e.src="assets/hulu.svg";break;case"HiDive":e.src="assets/hidive.svg";break;case"Wakanim":e.src="assets/wakanim.svg";break;case"YouTube":e.src="assets/youtube.svg";break;case"Netflix":e.src="assets/netflix.svg"}let t=document.createElement("a");t.id=n,t.href=o,t.target="_blank",t.className="stream",t.append(e),t.innerHTML+=" "+i,l=document.createElement("td"),l.innerHTML=parseInt(n)+1+" ",l.append(t),s=document.createElement("tr"),s.append(l),a.append(s)}i.append(a);let o=JSON.parse(localStorage.getItem("shows")),r=document.createElement("button");r.className="setter",e in o?(r.id="sub",r.innerHTML="Remove from Your List"):(r.id="add",r.innerHTML="Add to Your List");let c,m,d,u,g=document.createElement("button");g.id="reset",g.innerHTML="Reset",e in o&&("visible"==LEFT.style.visibility?o[e][0]:o[e][1])?g.style.visibility="visible":g.style.visibility="hidden";let p=localStorage.getItem("info");if("1"==p?(m=document.createElement("div"),m.append(i),c=document.createElement("aside"),c.append(m),c.append(r),c.append(g)):(u=document.createElement("img"),u.src=t[e].cover,u.width=340,u.height=440,d=document.createElement("div"),d.className="cover",d.append(u),m=document.createElement("div"),m.id="streams",m.append(i),c=document.createElement("div"),"2"==p&&(c.className="window"),c.append(r),c.append(g),c.append(d),c.append(m)),c.id="show",document.getElementById("content").append(c),"1"==p)document.querySelectorAll(".icon").forEach((e=>{e.style.height="1.5rem",e.style.width="1.5rem"})),document.getElementById("reset").style.margin="1rem 1rem";else{document.getElementById("reset").style.position="absolute";let e=document.querySelector(".setter");e.style.marginTop="24rem",e.style.position="absolute",e.style.padding="2px 10px",document.querySelectorAll(".icon").forEach((e=>{e.style.height="2rem",e.style.width="2rem"}))}resizeCalendar(),document.getElementById("clear").style.visibility="visible";let f=document.getElementById("list-js");f&&f.remove(),f=document.createElement("script"),f.id="list-js",f.src="js/list.min.js",document.head.append(f)}function updateTime(){const e=JSON.parse(localStorage.getItem("time"));let t=new Date;if(t=[t.getWeek(),t.getFullYear()],null!=e){let n=JSON.parse(localStorage.getItem("shows"));if(t[0]-e[0]==1&&t[1]==e[1]||t[1]-e[1]==1&&52==t[0])for(let e in n)[n[e][0],n[e][1]]=[!1,n[e][0]];else if(t[0]!=e[0]||t[1]!=e[1])for(let e in n)[n[e][0],n[e][1]]=[!1,!1];localStorage.setItem("shows",JSON.stringify(n))}localStorage.setItem("time",JSON.stringify(t))}LEFT.style.visibility="visible",RIGHT.style.visibility="visible",window.onload=()=>{let e=document.createElement("script");e.src="js/search.min.js";let t="21.2.5";localStorage.getItem("ver")!=t?(localStorage.setItem("ver",t),set("./shows/shows.json","store"),set("./shows/past_shows.json","past").then((()=>{let e=JSON.parse(localStorage.getItem("shows"));for(let t in e)t in STORE&&t in PAST||delete e[t];localStorage.setItem("shows",JSON.stringify(e))})).finally((()=>{TheBigBang(),document.body.append(e)}))):(TheBigBang(),document.body.append(e))},document.addEventListener("keydown",(e=>{if(hotkey(e))switch(e.key){case"c":clear();break;case"f":document.getElementById("format").focus();break;case"i":document.getElementById("info").focus();break;case"l":list();break;case"m":let t=document.getElementById("calendar");t?t.focus():document.getElementById("season").focus();break;case"n":right();break;case"p":left();break;case"s":document.getElementById("search").focus(),e.preventDefault();break;case"Escape":case"Enter":e.target.blur()}})),Date.prototype.getWeek=function(){const e=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()));return e.setDate(e.getDate()-e.getDay()),Math.ceil((e.valueOf()-new Date(e.getFullYear(),0,1).valueOf())/864e5/7)};
