"use strict";let PAST=JSON.parse(localStorage.getItem("past")),STORE=JSON.parse(localStorage.getItem("store"));document.getElementById("info").selectedIndex=parseInt(localStorage.getItem("info")),document.getElementById("format").selectedIndex=parseInt(localStorage.getItem("format")),localStorage.getItem("list")&&(document.getElementById("list").innerHTML=localStorage.getItem("list")),localStorage.getItem("shows")||localStorage.setItem("shows",JSON.stringify({}));let LEFT=document.getElementById("left"),RIGHT=document.getElementById("right");function format(){localStorage.setItem("format",document.getElementById("format").value),"visible"==LEFT.style.visibility?TheBigBang():TheBigBang(-7)}function clear(){let e=document.getElementById("show");e&&(e.remove(),document.getElementById("clear").style.visibility="hidden",document.getElementById("calendar").style.height="50rem")}function list(){let e=document.getElementById("list");e.innerHTML="Full List"==e.innerHTML?"Your List":"Full List",localStorage.setItem("list",e.innerHTML),document.getElementById("calendar")&&(document.getElementById("soon")||("visible"==LEFT.style.visibility?TheBigBang():TheBigBang(-7)))}function left(){if("visible"==LEFT.style.visibility)if("visible"==RIGHT.style.visibility)LEFT.style.visibility="hidden",TheBigBang(-7);else{let e=document.getElementById("soon");e&&e.remove(),RIGHT.style.visibility="visible",LEFT.style.visibility="visible",TheBigBang()}}function right(){"visible"==RIGHT.style.visibility&&("visible"==LEFT.style.visibility?(RIGHT.style.visibility="hidden",document.getElementById("calendar").remove(),document.getElementById("month").textContent="Fall 2021",season()):(RIGHT.style.visibility="visible",LEFT.style.visibility="visible",TheBigBang()))}async function set(e,t){let s=await(await fetch(e)).json();"store"==t?STORE=s:PAST=s,localStorage.setItem(t,JSON.stringify(s))}function TheBigBang(e=0){let t=document.getElementById("calendar");t?t.remove():document.getElementById("season").remove(),updateTime();let s=localStorage.getItem("format");fetch(0==e?"./shows/time.json":"./shows/past_time.json").then((e=>e.json())).then((t=>{switch(s){case"1":t=t.cutoff;break;case"2":t=t.compact;break;default:t=t.full}if("Your List"==localStorage.getItem("list")||0==Object.keys(JSON.parse(localStorage.getItem("shows"))).length)$("body").append(calendar(getDates(e),t));else switch(s){case"1":$("body").append(calendar(getDates(e),cutoff(t,e)));break;case"2":$("body").append(calendar(getDates(e),compact(t,e)));break;default:$("body").append(calendar(getDates(e),full(t,e)))}resizeCalendar(),createShows(e)}))}function calendar(e,t){let s='<div id="calendar"><table><thead><tr><td class="date"></th>';return e.forEach((async function(e){s+='<td class="date">'+e.getDate()+" "+e.toLocaleDateString("en-US",{weekday:"long"})+"</td>"})),s+="</tr></thead><tbody>",t.forEach((async function(e){s+='<tr><td class="time">'+e+"</td>";for(let t=1;t<8;t++)s+='<td class="slot" id="'+ider_slot(t,e)+'"></td>';s+="</tr>"})),s+="</tbody></table></div>",document.getElementById("month").innerHTML=e[0].getMonth()==e[6].getMonth()?e[0].toLocaleDateString("en-US",{month:"long"}):e[0].toLocaleDateString("en-US",{month:"long"})+" to "+e[6].toLocaleDateString("en-US",{month:"long"}),s}function getDates(e=0){let t=[],s=new Date,i=s.getDate(),a=s.getMonth(),n=s.getFullYear();switch(s.getDay()){case 0:i+=e-6;break;case 1:i+=e;break;case 2:i+=e-1;break;case 3:i+=e-2;break;case 4:i+=e-3;break;case 5:i+=e-4;break;case 6:i+=e-5}for(let e=0;e<7;e++)t.push(new Date(n,a,i+e));return t}function ider_slot(e,t){return":"==t.substring(1,2)?1e4*e+100*parseInt(t.substring(0,1))+parseInt(t.substring(2,4))+t.substring(5,6):1e4*e+100*parseInt(t.substring(0,2))+parseInt(t.substring(3,5))+t.substring(6,7)}function ider_show(e){let t=e.split(" ");return e.length+t.length.toString()+t[t.length-1].replace(/\W/g,"")}function createShows(e){const t=0==e?STORE:PAST,s=JSON.parse(localStorage.getItem("shows"));for(let e in"Your List"==document.getElementById("list").innerHTML?t:s)if(e in t){let i="";e in s&&(i=("visible"==LEFT.style.visibility?s[e][0]:s[e][1])?' style="border-color: #4f004f; color: #4f4f4f;" ':' style="border-color: #4f004f;" ');let a="#"+ider_slot(t[e].day,t[e].time);$(a).append('<a href="'+a+'"><button id="'+ider_show(e)+'" class="show"'+i+">"+e+"</button></a>")}$("#show-js").remove(),$("html").append('<script id="show-js" src="js/show.min.js"><\/script>')}function full(e,t){const s=JSON.parse(localStorage.getItem("shows")),i=0==t?STORE:PAST;let a=[];for(let t in e)if(e[t].includes("00")||e[t].includes("30"))a.push(e[t]);else for(let n in s)if(n in i){if(i[n].time.includes("00")||i[n].time.includes("30"))delete s[n];else if(e[t]==i[n].time){a.push(e[t]),delete s[n];break}}else delete s[n];return a}function minMax(e,t){return new Date("2000/1/1 "+e)<new Date("2000/1/1 "+t)?[e,t]:[t,e]}function cutoff(e,t){const s=JSON.parse(localStorage.getItem("shows")),i=0==t?STORE:PAST;let a="12:00 AM",n="11:59 PM";switch(s.length){case 0:return e;case 1:return[i[Object.keys(s)[0]].time];default:for(let e in s)e in i?(a=minMax(a,i[e].time)[1],n=minMax(n,i[e].time)[0],(i[e].time.includes("00")||i[e].time.includes("30"))&&delete s[e]):delete s[e]}let l=[],o=!1;for(let t in e)if(n==e[t])l.push(e[t]),o=!0;else{if(a==e[t]){l.push(e[t]);break}if(o)if(e[t].includes("00")||e[t].includes("30"))l.push(e[t]);else for(let a in s)if(e[t]==i[a].time){l.push(e[t]),delete s[a];break}}return l}function compact(e,t){const s=0==t?STORE:PAST,i=JSON.parse(localStorage.getItem("shows"));let a=[];for(let t in e){for(let n in i){if(n in s&&s[n].time==e[t]){a.push(e[t]),delete i[n];break}n in s||delete i[n]}if(0==i.length)break}return a}function resizeCalendar(){0!=Object.keys($("#show")).length&&"0"==$("#info")[0].value?$("#calendar").css({height:"25rem"}):$("#calendar").css({height:"50rem"})}function streamInfo(e){const t=e in STORE?STORE:PAST;$("#show").remove(),$(".arrow").off("click.arrow");let s='<table class="table table-hover"><tbody><tr><td id="title">'+e+"</td></tr>";if(0==Object.keys(t[e].streams).length)s+='<tr><td>No legal stream available</td></tr><tr><td>1 <a id="0" class="stream" href="#"><img class="icon" src="assets/skull.svg"> High Seas</a></td></tr>';else for(const[i,[a,n]]of Object.entries(Object.entries(t[e].streams))){switch(s+="<tr><td>"+(parseInt(i)+1)+' <a id="'+i+'"class="stream" href="'+n+'" target="_blank">',a){case"Crunchyroll":s+='<img class="icon" src="assets/crunchyroll.svg">';break;case"Funimation":s+='<img class="icon" src="assets/funimation.svg">';break;case"VRV":s+='<img class="icon" src="assets/vrv.svg">';break;case"AnimeLab":s+='<img class="icon" src="assets/animelab.svg">';break;case"Hulu":s+='<img class="icon" src="assets/hulu.svg">';break;case"HiDive":s+='<img class="icon" src="assets/hidive.svg">';break;case"Wakanim":s+='<img class="icon" src="assets/wakanim.svg">';break;case"YouTube":s+='<img class="icon" src="assets/youtube.svg">';break;case"Netflix":s+='<img class="icon" src="assets/netflix.svg">'}s+=" "+a+"</a></td>"}let i=JSON.parse(localStorage.getItem("shows"));const a=e in i?'<button id="sub" class="setter">Remove from Your List</button>':'<button id="add" class="setter">Add to Your List</button>',n=e in i&&("visible"==LEFT.style.visibility?i[e][0]:i[e][1])?'<button id="reset" style="">Reset</button>':'<button id="reset" style="visibility: hidden">Reset</button>';switch(localStorage.getItem("info")){case null:case"0":$("#content").append('<h3 id="show">'+a+n+'<div class="cover"><img src="'+t[e].cover+'" width="340" height="440"></div><div id="streams">'+s+"</div>");break;case"1":$("#content").append('<aside id="show"><h2>'+s+"</h2></aside>"),$("#show").append(a+n);break;case"2":$("#content").append('<h3 id="show" class="window">'+a+n+'<div class="cover"><img src="'+t[e].cover+'" width="340" height="440"></div><div id="streams">'+s+"</div>")}switch(localStorage.getItem("info")){case null:case"2":case"0":$("#reset").css({position:"absolute"}),$(".icon").css({height:"2rem",width:"2rem"}),$(".setter").css({"margin-top":"24rem",position:"absolute",padding:"2px 10px"});break;case"1":$(".icon").css({height:"1.5rem",width:"1.5rem"})}resizeCalendar(),$("#clear").css({visibility:"visible"});let l=document.getElementById("list-js");l&&l.remove(),l=document.createElement("script"),l.id="list-js",l.src="js/list.min.js",document.body.append(l)}function updateTime(){const e=JSON.parse(localStorage.getItem("time"));let t=new Date;if(t=[t.getWeek(),t.getFullYear()],null!=e){let s=JSON.parse(localStorage.getItem("shows"));if(t[0]-e[0]==1&&t[1]==e[1]||t[1]-e[1]==1&&52==t[0])for(let e in s)[s[e][0],s[e][1]]=[!1,s[e][0]];else if(t[0]!=e[0]||t[1]!=e[1])for(let e in s)[s[e][0],s[e][1]]=[!1,!1];localStorage.setItem("shows",JSON.stringify(s))}localStorage.setItem("time",JSON.stringify(t))}function menu(){let e=document.getElementById("menu");e.style.visibility="visible"==e.style.visibility?"hidden":"visible"}LEFT.style.visibility="visible",RIGHT.style.visibility="visible",window.onload=()=>{let e=document.createElement("script");e.src="js/search.min.js";let t="21.2.4";localStorage.getItem("ver")!=t?(localStorage.setItem("ver",t),set("./shows/shows.json","store"),set("./shows/past_shows.json","past").then((()=>{let e=JSON.parse(localStorage.getItem("shows"));for(let t in e)t in STORE&&t in PAST||delete e[t];localStorage.setItem("shows",JSON.stringify(e))})).finally((()=>{TheBigBang(),document.body.append(e)}))):(TheBigBang(),document.body.append(e))},document.addEventListener("keydown",(e=>{if("search"!=e.target.id)switch(e.key){case"c":clear();break;case"f":document.getElementById("format").focus();break;case"i":document.getElementById("info").focus();break;case"l":list();break;case"m":let t=document.getElementById("calendar");t?t.focus():document.getElementById("season").focus();break;case"n":right();break;case"p":left();break;case"s":document.getElementById("search").focus(),e.preventDefault();break;case"Escape":case"Enter":e.target.blur()}})),Date.prototype.getWeek=function(){const e=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()));return e.setDate(e.getDate()-e.getDay()),Math.ceil((e.valueOf()-new Date(e.getFullYear(),0,1).valueOf())/864e5/7)},window.matchMedia("(min-width: 800px)").addListener((e=>{document.getElementById("menu").style.visibility="hidden"}));
