"use strict";Date.prototype.getWeek=function(){const e=new Date(Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()));return e.setDate(e.getDate()-e.getDay()),Math.ceil((e.valueOf()-new Date(e.getFullYear(),0,1).valueOf())/864e5/7)};class Calendar{constructor(e){this.left=document.getElementById("left"),this.right=document.getElementById("right"),this.left.style.visibility="visible",this.right.style.visibility="visible",this.past=JSON.parse(localStorage.getItem("past")),this.store=JSON.parse(localStorage.getItem("store")),localStorage.getItem("ver")!=e&&(localStorage.setItem("ver",e),this.set("./shows/shows.json","store"),this.set("./shows/past_shows.json","past").then((()=>{let e=JSON.parse(localStorage.getItem("shows"));for(let t in e)t in this.store||t in this.past||delete e[t];localStorage.setItem("shows",JSON.stringify(e))})))}async set(e,t){let s=await(await fetch(e)).json();"store"==t?cal.store=s:cal.past=s,localStorage.setItem(t,JSON.stringify(s))}async init(e=0){let t=document.getElementById("calendar");t?t.remove():document.getElementById("season").remove(),this.updateTime();let s,i=localStorage.getItem("format"),l=await(await fetch(0==e?"./shows/time.json":"./shows/past_time.json")).json();switch(i){case"1":l=l.cutoff;break;case"2":l=l.compact;break;default:l=l.full}if("Your List"==localStorage.getItem("list")||0==Object.keys(JSON.parse(localStorage.getItem("shows"))).length)s=l;else switch(i){case"1":s=this.cutoff(l,e);break;case"2":s=this.compact(l,e);break;default:s=this.full(l,e)}this.calendar(this.getDates(e),s),this.resizeCalendar(),this.createShows(e)}calendar(e,t){document.getElementById("month").innerHTML=e[0].getMonth()==e[6].getMonth()?e[0].toLocaleDateString("en-US",{month:"long"}):e[0].toLocaleDateString("en-US",{month:"long"})+" to "+e[6].toLocaleDateString("en-US",{month:"long"});let s=document.createElement("td");s.className="date corner";let i=document.createElement("tr");i.append(s),e.forEach((async function(e){s=document.createElement("td"),s.className="date",s.innerHTML=e.getDate()+" "+e.toLocaleDateString("en-US",{weekday:"long"}),s.title=e.getDate()+" "+e.toLocaleDateString("en-US",{weekday:"short"}),i.append(s)}));let l=document.createElement("thead");l.append(i);let n=document.createElement("tbody");t.forEach((async e=>{s=document.createElement("td"),s.className="time",s.innerHTML=e,i=document.createElement("tr"),i.append(s);for(let t=1;t<8;t++)s=document.createElement("td"),s.id=this.ider_slot(t,e),s.className="slot",i.append(s);n.append(i)}));let a=document.createElement("table");a.append(l),a.append(n);let r=document.createElement("div");r.id="calendar",r.tabIndex=1,r.append(a),document.body.append(r)}getDates(e=0){let t=[],s=new Date,i=s.getDate(),l=s.getMonth(),n=s.getFullYear();switch(s.getDay()){case 0:i+=e-6;break;case 1:i+=e;break;case 2:i+=e-1;break;case 3:i+=e-2;break;case 4:i+=e-3;break;case 5:i+=e-4;break;case 6:i+=e-5}for(let e=0;e<7;e++)t.push(new Date(n,l,i+e));return t}ider_slot(e,t){return":"==t.substring(1,2)?1e4*e+100*parseInt(t.substring(0,1))+parseInt(t.substring(2,4))+t.substring(5,6):1e4*e+100*parseInt(t.substring(0,2))+parseInt(t.substring(3,5))+t.substring(6,7)}ider_show(e){let t=e.split(" ");return e.length+t.length.toString()+t[t.length-1].replace(/\W/g,"")}createShows(e){const t=0==e?this.store:this.past,s=JSON.parse(localStorage.getItem("shows"));for(let e in"Your List"==document.getElementById("list").innerHTML?t:s)if(e in t){let i=document.createElement("button");i.id=this.ider_show(e),i.className="show",i.innerHTML=e,e in s&&(i.style.borderColor="#4f004f",i.style.color=("visible"==this.left.style.visibility?s[e][0]:s[e][1])?"#4f4f4f":"purple"),i.onclick=e=>{"0"==localStorage.getItem("info")?document.getElementById("title")&&e.preventDefault():e.preventDefault(),this.streamInfo(e.target.innerHTML)};let l=document.createElement("a"),n=this.ider_slot(t[e].day,t[e].time);l.href="#"+n,l.append(i),document.getElementById(n).append(l)}}full(e,t){const s=JSON.parse(localStorage.getItem("shows")),i=0==t?this.store:this.past;let l=[];for(let t in e)if(e[t].includes("00")||e[t].includes("30"))l.push(e[t]);else for(let n in s)if(n in i){if(i[n].time.includes("00")||i[n].time.includes("30"))delete s[n];else if(e[t]==i[n].time){l.push(e[t]),delete s[n];break}}else delete s[n];return l}minMax(e,t){return new Date("2000/1/1 "+e)<new Date("2000/1/1 "+t)?[e,t]:[t,e]}cutoff(e,t){const s=JSON.parse(localStorage.getItem("shows")),i=0==t?this.store:this.past;let l="12:00 AM",n="11:59 PM";switch(s.length){case 0:return e;case 1:return[i[Object.keys(s)[0]].time];default:for(let e in s)e in i?(l=this.minMax(l,i[e].time)[1],n=this.minMax(n,i[e].time)[0],(i[e].time.includes("00")||i[e].time.includes("30"))&&delete s[e]):delete s[e]}let a=[],r=!1;for(let t in e)if(n==e[t])a.push(e[t]),r=!0;else{if(l==e[t]){a.push(e[t]);break}if(r)if(e[t].includes("00")||e[t].includes("30"))a.push(e[t]);else for(let l in s)if(e[t]==i[l].time){a.push(e[t]),delete s[l];break}}return a}compact(e,t){const s=0==t?this.store:this.past,i=JSON.parse(localStorage.getItem("shows"));let l=[];for(let t in e){for(let n in i){if(n in s&&s[n].time==e[t]){l.push(e[t]),delete i[n];break}n in s||delete i[n]}if(0==i.length)break}return l}resizeCalendar(){let e=document.getElementById("calendar");e&&(e.style.height="0"==document.getElementById("info").value&&document.getElementById("show")?"38vh":"85vh")}streamInfo(e){const t=e in this.store?this.store:this.past;let s=document.getElementById("show");s&&s.remove();let i=document.createElement("td");i.id="title",i.innerHTML=e;let l=document.createElement("tr");l.append(i);let n=document.createElement("tbody");n.append(l);let a=document.createElement("table");if(0==Object.keys(t[e].streams).length){i=document.createElement("td"),i.innerHTML="No legal stream available",l=document.createElement("tr"),l.append(i),n.append(l);let e=document.createElement("img");e.className="icon",e.src="assets/skull.svg";let t=document.createElement("a");t.id="0",t.className="stream",t.onclick=()=>this.Stream(),t.href="#",t.append(e),t.innerHTML+=" High Seas",i=document.createElement("td"),i.innerHTML="1 ",i.append(t),l=document.createElement("tr"),l.append(i),n.append(l)}else for(const[s,[a,r]]of Object.entries(Object.entries(t[e].streams))){let e=document.createElement("img");switch(e.className="icon",a){case"Crunchyroll":e.src="assets/crunchyroll.svg";break;case"Funimation":e.src="assets/funimation.svg";break;case"VRV":e.src="assets/vrv.svg";break;case"AnimeLab":e.src="assets/animelab.svg";break;case"Hulu":e.src="assets/hulu.svg";break;case"HiDive":e.src="assets/hidive.svg";break;case"Wakanim":e.src="assets/wakanim.svg";break;case"YouTube":e.src="assets/youtube.svg";break;case"Netflix":e.src="assets/netflix.svg"}let t=document.createElement("a");t.id=s,t.href=r,t.target="_blank",t.className="stream",t.onclick=()=>this.Stream(),t.append(e),t.innerHTML+=" "+a,i=document.createElement("td"),i.innerHTML=parseInt(s)+1+" ",i.append(t),l=document.createElement("tr"),l.append(i),n.append(l)}a.append(n);let r=JSON.parse(localStorage.getItem("shows")),o=document.createElement("button");o.className="setter",o.onclick=()=>this.setter(),e in r?(o.id="sub",o.innerHTML="Remove from Your List"):(o.id="add",o.innerHTML="Add to Your List");let c,d,m,h,g=document.createElement("button");g.onclick=()=>this.Reset(),g.id="reset",g.innerHTML="Reset",g.style.visibility=e in r&&("visible"==this.left.style.visibility?r[e][0]:r[e][1])?"visible":"hidden";let u=localStorage.getItem("info");"1"==u?(c=document.createElement("aside"),c.append(a),c.append(o),c.append(g)):(h=document.createElement("img"),h.src=t[e].cover,m=document.createElement("div"),m.className="cover",m.append(h),d=document.createElement("div"),d.id="streams",d.append(a),c=document.createElement("div"),"2"==u&&(c.className="window"),c.align="center",c.append(o),c.append(g),c.append(m),c.append(d)),c.id="show",document.getElementById("content").append(c),this.resizeCalendar(),document.getElementById("clear").style.visibility="visible"}updateTime(){const e=JSON.parse(localStorage.getItem("time"));let t=new Date;if(t=[t.getWeek(),t.getFullYear()],null!=e){let s=JSON.parse(localStorage.getItem("shows"));if(t[0]-e[0]==1&&t[1]==e[1]||t[1]-e[1]==1&&52==t[0])for(let e in s)[s[e][0],s[e][1]]=[!1,s[e][0]];else if(t[0]!=e[0]||t[1]!=e[1])for(let e in s)[s[e][0],s[e][1]]=[!1,!1];localStorage.setItem("shows",JSON.stringify(s))}localStorage.setItem("time",JSON.stringify(t))}link(e){let t=document.getElementById(e);t&&this.Stream(),t.href.includes(window.location.host)||window.open(t.href)}Stream(){let e=document.getElementById("title").innerHTML,t=JSON.parse(localStorage.getItem("shows"));e in t&&(this.updateSetter(t,e,!0),document.getElementById(cal.ider_show(e)).style.color="#4f4f4f",document.getElementById("reset").style.visibility="visible"),localStorage.setItem("shows",JSON.stringify(t))}updateSetter(e,t,s){"visible"==this.left.style.visibility?e[t][0]=s:e[t][1]=s}Reset(){let e=document.getElementById("title").innerHTML,t=JSON.parse(localStorage.getItem("shows"));this.updateSetter(t,e,!1),document.getElementById(cal.ider_show(e)).style.color="purple",document.getElementById("reset").style.visibility="hidden",localStorage.setItem("shows",JSON.stringify(t))}arrow(){let e=document.getElementById("title");if(e){e=e.innerHTML;let t=JSON.parse(localStorage.getItem("shows"));document.getElementById("season")?document.getElementById("show").remove():e in t&&(document.getElementById("reset").style.visibility=("visible"==this.left.style.visibility?t[e][0]:t[e][1])?"visible":"hidden")}}setter(){let e=document.getElementById("title").innerHTML,t=document.querySelector(".setter"),s=JSON.parse(localStorage.getItem("shows"));if("add"==t.id){let i=document.getElementById(cal.ider_show(e));i&&(i.style.borderColor="#4f004f"),t.innerHTML="Remove from Your List",t.id="sub",s[e]=[!1,!1]}else null!=s&&e in s&&(delete s[e],document.getElementById("reset").style.visibility="hidden",document.getElementById(cal.ider_show(e)).style.borderColor="#484848",t.innerHTML="Add to Your List",t.id="add");localStorage.setItem("shows",JSON.stringify(s)),"Full List"==document.getElementById("list").innerHTML&&("visible"==this.left.style.visibility?cal.init():cal.init(-7))}format(){localStorage.setItem("format",document.getElementById("format").value),"visible"==this.left.style.visibility?this.init():this.init(-7)}clear(){let e=document.getElementById("show");e&&(e.remove(),document.getElementById("clear").style.visibility="hidden",this.resizeCalendar())}Left(){"visible"==this.left.style.visibility&&("visible"==this.right.style.visibility?(this.left.style.visibility="hidden",this.init(-7)):(this.right.style.visibility="visible",this.left.style.visibility="visible",this.init()))}Right(){"visible"==this.right.style.visibility&&("visible"==this.left.style.visibility?(this.right.style.visibility="hidden",document.getElementById("clear").style.visibility="hidden",document.getElementById("calendar").remove(),document.getElementById("month").innerHTML="Winter 2021",son.init()):(this.right.style.visibility="visible",this.left.style.visibility="visible",this.init()))}info(){localStorage.setItem("info",document.getElementById("info").value),document.getElementById("title")&&this.streamInfo(document.getElementById("title").innerHTML)}}
