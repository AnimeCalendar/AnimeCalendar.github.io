"use strict";let PAST=JSON.parse(localStorage.getItem("past")),STORE=JSON.parse(localStorage.getItem("store"));document.getElementById("info").selectedIndex=parseInt(localStorage.getItem("info")),document.getElementById("format").selectedIndex=parseInt(localStorage.getItem("format")),localStorage.getItem("list")&&(document.getElementById("list").innerHTML=localStorage.getItem("list")),localStorage.getItem("shows")||localStorage.setItem("shows",JSON.stringify({}));let LEFT=document.getElementById("left"),RIGHT=document.getElementById("right");LEFT.style.visibility="visible",RIGHT.style.visibility="visible";let cal=new Calendar;async function set(e,t){let a=await(await fetch(e)).json();"store"==t?STORE=a:PAST=a,localStorage.setItem(t,JSON.stringify(a))}window.onload=()=>{let e="21.3.2";localStorage.getItem("ver")!=e?(localStorage.setItem("ver",e),set("./shows/shows.json","store"),set("./shows/past_shows.json","past").then((()=>{let e=JSON.parse(localStorage.getItem("shows"));for(let t in e)t in STORE||t in PAST||delete e[t];localStorage.setItem("shows",JSON.stringify(e))})).finally((()=>{cal.TheBigBang(),new Search(STORE,PAST)}))):(cal.TheBigBang(),new Search(STORE,PAST)),new Streams},window.matchMedia("(min-width: 1200px)").addListener((e=>{document.querySelectorAll(".date").forEach((e=>{[e.innerHTML,e.title]=[e.title,e.innerHTML]}))})),document.addEventListener("keydown",(e=>{if("search"!=e.target.id&&!e.ctrlKey&&!e.altKey){switch(e.key){case"c":cal.clear();break;case"f":document.getElementById("format").focus();break;case"i":document.getElementById("info").focus();break;case"l":cal.list();break;case"m":let t=document.getElementById("calendar");t?t.focus():document.getElementById("season").focus();break;case"n":cal.right();break;case"p":cal.left();break;case"s":document.getElementById("search").focus(),e.preventDefault();break;case"Escape":case"Enter":e.target.blur()}if(document.getElementById("show")){switch(e.key){case"a":cal.setter();break;case"n":case"p":cal.arrow();break;case"r":cal.Reset();break;case"w":let t={};document.querySelectorAll(".stream").forEach((e=>t[e.innerText.substring(1)]=e.href));let a=JSON.parse(localStorage.getItem("streams")),s=!0;for(const e in a)if(a[e][1]&&a[e][0]in t){window.open(t[a[e][0]]),s=!1,cal.Stream();break}if(s){let e=document.querySelector(".stream-box");e.style.backgroundColor="darkred",setTimeout((()=>e.style.backgroundColor="black"),50)}break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":cal.link(""+(parseInt(e.key)-1))}e.stopImmediatePropagation()}}}));
