"use strict";class Season{constructor(){this.row=(e,t)=>{const s=document.createElement("tr"),n=document.createElement("td");return n.innerHTML=`${e}: ${t}`,s.append(n),s},this.list=JSON.parse(localStorage.getItem("season"))??{},Object.keys(this.list).forEach(e=>{e in CAL.store&&(CAL.shows[e]=[!1,!1],delete this.list[e])}),localStorage.setItem("season",JSON.stringify(this.list)),localStorage.setItem("shows",JSON.stringify(CAL.shows))}async init(){const e=document.createElement("div");e.id="season",e.tabIndex=1,document.body.append(e);const t=await(await fetch("season/shows.json")).json();let s=0;Object.keys("Your List"===document.getElementById("list").innerHTML?t:this.list).forEach(n=>{const i=document.createElement("div");i.className="show-season";const o=document.createElement("table");o.className="info",Object.keys(t[n]).forEach(a=>{switch(a){case"title":{const e=document.createElement("tr"),s=document.createElement("th");s.innerHTML=t[n].title,e.append(s),o.append(e);break}case"cover":{const o=document.createElement("div");o.className="cover-season";const r=document.createElement("img");if(r.src=`https://cdn.animeschedule.net/production/assets/public/img/anime/jpg/default/${t[n][a]}.jpg`,r.width=340,r.height=440,s>2){r.src+="?w=5&h=5";new IntersectionObserver((e,t)=>{e.forEach(e=>{if(!e.isIntersecting)return;const s=e.target;s.src=s.src.substring(0,s.src.length-8),t.unobserve(s)})},{root:e,rootMargin:"500px 0px"}).observe(r),r.loading="lazy"}else s++;o.append(r),i.append(o);break}case"genres":o.append(this.row(a,t[n][a].join(", ")));break;default:o.append(this.row(a,t[n][a]))}});const a=document.createElement("button");a.innerHTML=n in this.list?"Remove":"Add",a.setAttribute("key",n),a.onclick=e=>{const s=e.target.attributes.getNamedItem("key").value;s in this.list?(delete this.list[s],e.target.innerHTML="Add"):(this.list[s]=t[s].title.substring(0,10),e.target.innerHTML="Remove",this.list=Object.fromEntries(Object.entries(this.list).sort((e,t)=>e[1]<t[1]?0:1))),localStorage.setItem("season",JSON.stringify(this.list))},i.append(o),i.append(a),e.append(i)})}}
